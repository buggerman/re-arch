#!/bin/bash

set -euo pipefail

BASE_URL="${RE_ARCH_BASE_URL:-https://re-arch.xyz}"
BASE_URL="${BASE_URL%/}"

echo ""
echo "Re-Arch: Simple Arch Linux Desktop Installer"
echo "============================================="
echo ""
echo "Choose Desktop Environment:"
echo "1) KDE Plasma"
echo "2) GNOME" 
echo "3) XFCE"
echo "4) Hyprland"
echo ""

while true; do
    read -r -p "Enter choice (1 for KDE, 2 for GNOME, 3 for XFCE, 4 for Hyprland): " choice </dev/tty
    case $choice in
        1) desktop="kde"; break ;;
        2) desktop="gnome"; break ;;
        3) desktop="xfce"; break ;;
        4) desktop="hyprland"; break ;;
        *) echo "Invalid choice. Enter 1 for KDE, 2 for GNOME, 3 for XFCE, or 4 for Hyprland." ;;
    esac
done

echo "Starting installation with $desktop desktop..."

config_url="${BASE_URL}/config-${desktop}.json"
creds_url="${BASE_URL}/creds.json"

exec archinstall --config-url "$config_url" --creds-url "$creds_url"